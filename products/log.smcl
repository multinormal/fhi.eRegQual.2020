{smcl}
{com}{sf}{ul off}{txt}{.-}
      name:  {res}eRegQual Analysis
       {txt}log:  {res}/Users/cjr/Repos/fhi.eRegQual.2020/products/log.smcl
  {txt}log type:  {res}smcl
 {txt}opened on:  {res}31 Aug 2020, 12:46:27
{txt}
{com}. 
. // Set up Stata.
. do setup/setup
{txt}
{com}. version 16.1
{txt}
{com}. 
. // Set the random number generator seed.
. set seed 1234
{txt}
{com}. 
. // Set up Stata's path to use the "packages" directory for add-on packages.
. net set ado "./packages"
{txt}
{com}. sysdir set PERSONAL "./packages"
{txt}
{com}. 
. // Specify formats.
. set cformat %9.2f
{txt}
{com}. set pformat %5.2f
{txt}
{com}. set sformat %8.2f
{txt}
{com}. 
. 
{txt}end of do-file

{com}. 
. // Set up globals.
. do globals/globals
{txt}
{com}. version 16.1
{txt}
{com}. 
. // The number of imputations to perform.
. global m_imputations 50 // Very slightly narrower CI if m=100.
{txt}
{com}. 
. // Define the names of the process outcomes.
. global process_outcomes ""
{txt}
{com}. global process_outcomes $process_outcomes attendance hypertension diabetes
{txt}
{com}. global process_outcomes $process_outcomes malpresentation anemia fetalgrowth
{txt}
{com}. 
. // The variables to adjust for, with their "types". See the generated report for
. // an explanation of why these variables are adjusted for.
. global adj_vars i.strat_var c.cluster_size c.age i.lab_available i.primiparous
{txt}
{com}. global adj_var_names // A global with just the *names* of the adj_vars
{txt}
{com}. foreach x of global adj_vars {c -(}
{txt}  2{com}.   local x_name = substr("`x'", 3, .) // Remove the i. or c.
{txt}  3{com}.   global adj_var_names $adj_var_names `x_name'
{txt}  4{com}. {c )-}
{txt}
{com}. 
. // Define paths to the process outcome files.
. global fname_attendance      "data/raw/25June2020_eRegQual process outcomes_attendance.dta"
{txt}
{com}. global fname_hypertension    "data/raw/25June2020_eRegQual process outcomes_hypertension.dta"
{txt}
{com}. global fname_diabetes        "data/raw/25June2020_eRegQual process outcomes_diabetes.dta"
{txt}
{com}. global fname_malpresentation "data/raw/25June2020_eRegQual process outcomes_malpresentation.dta"
{txt}
{com}. global fname_anemia          "data/raw/02July2020_eRegQual process outcomes_anemia.dta"
{txt}
{com}. global fname_fetalgrowth     "data/raw/10August2020_eRegQual process outcomes_fetalgrowth.dta"
{txt}
{com}. 
. // Define data signatures for the process outcome files.
. global datasignature_attendance          "6367:39(51496):3578513271:2127801624"
{txt}
{com}. global datasignature_hypertension        "6367:60(68365):3970041110:3735367683"
{txt}
{com}. global datasignature_diabetes            "6367:38(91264):1895688975:3113856828"
{txt}
{com}. global datasignature_malpresentation     "6367:31(88392):1586201653:3483051938"
{txt}
{com}. global datasignature_anemia              "6367:51(74410):3453863737:2485498443"
{txt}
{com}. global datasignature_fetalgrowth         "6367:37(83879):2470058122:813121498"
{txt}
{com}. 
. // Define recoding rules for the arm variables of the process outcomes; the 
. // coding of control and intervention vary by outcome. We will adopt the 
. // convention that control is coded as 1 and intervention as 2.
. global recode_attendance   recode arm (1 = 2) (2 = 1)
{txt}
{com}. global recode_hypertension recode arm (1 = 2) (2 = 1)
{txt}
{com}. foreach x in diabetes malpresentation anemia fetalgrowth {c -(}
{txt}  2{com}.   global recode_`x' // No recoding necessary
{txt}  3{com}. {c )-}
{txt}
{com}. 
{txt}end of do-file

{com}. 
. // Import the data.
. do data/process_outcomes
{txt}
{com}. version 16.1
{txt}
{com}. 
. // Record the maximum percentage of data missing for age for process outcomes.
. global max_miss_age_pc 0
{txt}
{com}. 
. foreach outcome of global process_outcomes {c -(}
{txt}  2{com}.   frame create `outcome'
{txt}  3{com}.   frame `outcome' {c -(}
{txt}  4{com}.     // Load the data and check its signature is as expected.
.     use "${c -(}fname_`outcome'{c )-}", replace
{txt}  5{com}.     datasignature
{txt}  6{com}.     assert r(datasignature) == "${c -(}datasignature_`outcome'{c )-}"
{txt}  7{com}. 
.     // Encode/rename arm and cluster identifier variables.
.     encode prettyExposure, generate(arm)
{txt}  8{com}.     rename str_TRIAL_1_Cluster clusterid
{txt}  9{com}. 
.     // Compute the cluster size from the trial data. We use the trial data for
.     // simplicity and have verified that these agree with the "baseline" data on
.     // trial size. We divide by 100 because cluster sizes range from about 10 to
.     // about 220, and we want to get regression coefficients that are non-null
.     // within two decimal places! Note that cluster size computation must be
.     // done before the data set is reshaped to long format, or we will count
.     // one enrollment per visit rather than pregnancy.
.     by clusterid, sort: generate cluster_size = _N / 100
{txt} 10{com}. 
.     // Reshape to long format. Note that the uniqueid variable is not actually
.     // unique but identifies women, who can have multiple pregnancies (but not
.     // twins in this data set). Rows in the wide data frame are pregnancies, so
.     // we simply generate a unique pregnancy number for each row. We generate a 
.     // visit variable, as each woman (pregnancy) may attend clinic multiple times. 
.     generate pregnancy = _n
{txt} 11{com}.     local stubs opportunity_`outcome'_ success_`outcome'_
{txt} 12{com}.     reshape long `stubs', i(pregnancy) j(visit)
{txt} 13{com}. 
.     // While the outcome variable is a factor with three levels, we are only 
.     // interested in the relative odds of success. The other levels are 
.     // "NOT SUCCESSFUL" and "NOT APPLICABLE". Not applicable is not of 
.     // scientific interest here.
.     local success_label_name = "`: value label success_`outcome'_'"
{txt} 14{com}.     drop if      success_`outcome'_ == "NOT APPLICABLE":`success_label_name'
{txt} 15{com}.     generate y = success_`outcome'_ == "SUCCESSFUL":`success_label_name'
{txt} 16{com}. 
.     // Convert the stratification variable from string to integer.
.     encode bookorgdistricthashed, generate(strat_var)
{txt} 17{com}.     
.     // Generate an indicator for whether each woman is primiparous.
.     rename bookprimi primiparous
{txt} 18{com}. 
.     // Age.
.     replace age = . if age <= 1 // Correct some mis-coded values of the age variable.
{txt} 19{com}.     label variable age "Age (years)"
{txt} 20{com}. 
.     // Keep only the variables of interest.
.     keep y arm pregnancy visit clusterid $adj_var_names
{txt} 21{com}. 
.     // Label the variables
.     label variable y             "Successful `outcome'"
{txt} 22{com}.     label variable arm           "Study arm"
{txt} 23{com}.     label variable pregnancy     "Pregnancy"
{txt} 24{com}.     label variable clusterid     "Cluster"
{txt} 25{com}.     label variable strat_var     "District"
{txt} 26{com}.     label variable lab_available "Lab availability"
{txt} 27{com}.     label variable cluster_size  "Cluster size" // 100s of new enrollments
{txt} 28{com}.     label variable age           "Age (years)"
{txt} 29{com}.     label variable primiparous   "Parity"       // Indicator of primiparity.
{txt} 30{com}. 
.     // Label values and set base level where appropriate.
.     label define lab_available_label                1 "Lab"          0 "No lab"
{txt} 31{com}.     label values lab_available lab_available_label
{txt} 32{com}.     label define primiparous_label                  1 "Primi"        0 "Multi"
{txt} 33{com}.     label values primiparous   primiparous_label
{txt} 34{com}.     
.     // Recode the arm levels, ensure that level 1 is control, and set the
.     // value labels.
.     ${c -(}recode_`outcome'{c )-}
{txt} 35{com}.     fvset base 1 arm
{txt} 36{com}.     label define arm_value_label 1 "Control" 2 "Intervention"
{txt} 37{com}.     label values arm arm_value_label
{txt} 38{com}. 
.     // There should only be missing data for the age variable.
.     describe, short varlist
{txt} 39{com}.     local vars = r(varlist)
{txt} 40{com}.     local vars = ustrtrim(usubinstr("`vars'", "age", "", .))
{txt} 41{com}.     foreach x of local vars {c -(}
{txt} 42{com}.       misstable summarize `x'
{txt} 43{com}.       assert r(N_lt_dot) == .
{txt} 44{com}.     {c )-}
{txt} 45{com}. 
.     // The age variable should contain no more than 1.257% missing data.
.     misstable summarize age
{txt} 46{com}.     local miss_age_pc = 100 * (r(N_eq_dot) / (r(N_eq_dot) + r(N_lt_dot)))
{txt} 47{com}.     if `miss_age_pc' > $max_miss_age_pc global max_miss_age_pc = `miss_age_pc'
{txt} 48{com}.     drop if missing(age)
{txt} 49{com}.     assert r(N_drop) <= 300 // Ensure we did only drop a little data!
{txt} 50{com}. 
.     // For most of the process outcomes, we have multiple visits within
.     // pregnancy; we model the cluster-randomized design in the estimation.
.     // For malpresentation, there is only one visit and so cluster can be the
.     // panel variable. Note that the xtlogit-based analysis with cluster as the
.     // panel variable gives identical point estimates and confidence intervals
.     // as a melogit-based analysis with cluster as the random effect.
.     if "`outcome'" != "malpresentation" xtset pregnancy visit
{txt} 51{com}.     if "`outcome'" == "malpresentation" xtset clusterid
{txt} 52{com}.   {c )-}
{txt} 53{com}. {c )-}
  {res}6367:39(51496):3578513271:2127801624
{txt}(note: j = 1 2 3 4 5)

Data{col 36}wide{col 43}->{col 48}long
{hline 77}
Number of obs.                 {res}    6367   {txt}->{res}   31835
{txt}Number of variables            {res}      42   {txt}->{res}      35
{txt}j variable (5 values)                     ->   {res}visit
{txt}xij variables:
{res}opportunity_attendance_1 opportunity_attendance_2 ... opportunity_attendance_5{txt}->{res}opportunity_attendance_
success_attendance_1 success_attendance_2 ... success_attendance_5{txt}->{res}success_attendance_
{txt}{hline 77}
(10,132 observations deleted)
{res}{txt}(128 real changes made, 128 to missing)
(arm: 21703 changes made)

Contains data
  obs:{res}        21,703                          
{txt} vars:{res}            10                          
{txt}Sorted by: {res}pregnancy  visit
     Note: Dataset has changed since last saved.
{txt}(variables nonmissing or string)
(variables nonmissing or string)
(variables nonmissing or string)
(variables nonmissing or string)
(variables nonmissing or string)
(variables nonmissing or string)
(variables nonmissing or string)
(variables nonmissing or string)
(variables nonmissing or string)
{col 64}Obs<.
{col 49}{c TLC}{hline 30}
{col 16}{c |}{col 49}{c |} Unique
{col 7}Variable {c |}{col 22}Obs=.{col 32}Obs>.{col 42}Obs<.{col 49}{c |} values{col 65}Min{col 77}Max
  {hline 13}{c +}{hline 32}{c +}{hline 30}
           age {c |}{res}       273{txt}{space 10}{res}    21,430{txt}  {c |}     31         14          44
  {hline 13}{c BT}{hline 32}{c BT}{hline 30}
(273 observations deleted)
{res}{txt}{col 8}panel variable:  {res}pregnancy (unbalanced)
{txt}{col 9}time variable:  {res}{col 25}visit, 1 to 5
{txt}{col 17}delta:  {res}1 unit
  6367:60(68365):3970041110:3735367683
{txt}(note: j = 1 2 3 4 5 6 7 8)

Data{col 36}wide{col 43}->{col 48}long
{hline 77}
Number of obs.                 {res}    6367   {txt}->{res}   50936
{txt}Number of variables            {res}      63   {txt}->{res}      50
{txt}j variable (8 values)                     ->   {res}visit
{txt}xij variables:
{res}opportunity_hypertension_1 opportunity_hypertension_2 ... opportunity_hypertension_8{txt}->{res}opportunity_hypertension_
success_hypertension_1 success_hypertension_2 ... success_hypertension_8{txt}->{res}success_hypertension_
{txt}{hline 77}
(35,383 observations deleted)
{res}{txt}(102 real changes made, 102 to missing)
(arm: 15553 changes made)

Contains data
  obs:{res}        15,553                          
{txt} vars:{res}            10                          
{txt}Sorted by: {res}pregnancy  visit
     Note: Dataset has changed since last saved.
{txt}(variables nonmissing or string)
(variables nonmissing or string)
(variables nonmissing or string)
(variables nonmissing or string)
(variables nonmissing or string)
(variables nonmissing or string)
(variables nonmissing or string)
(variables nonmissing or string)
(variables nonmissing or string)
{col 64}Obs<.
{col 49}{c TLC}{hline 30}
{col 16}{c |}{col 49}{c |} Unique
{col 7}Variable {c |}{col 22}Obs=.{col 32}Obs>.{col 42}Obs<.{col 49}{c |} values{col 65}Min{col 77}Max
  {hline 13}{c +}{hline 32}{c +}{hline 30}
           age {c |}{res}       170{txt}{space 10}{res}    15,383{txt}  {c |}     32         14          45
  {hline 13}{c BT}{hline 32}{c BT}{hline 30}
(170 observations deleted)
{res}{txt}{col 8}panel variable:  {res}pregnancy (unbalanced)
{txt}{col 9}time variable:  {res}{col 25}visit, 1 to 8, but with gaps
{txt}{col 17}delta:  {res}1 unit
  6367:38(91264):1895688975:3113856828
{txt}(note: j = 1 2 3 4)
(note: success_diabetes_2 not found)

Data{col 36}wide{col 43}->{col 48}long
{hline 77}
Number of obs.                 {res}    6367   {txt}->{res}   25468
{txt}Number of variables            {res}      41   {txt}->{res}      37
{txt}j variable (4 values)                     ->   {res}visit
{txt}xij variables:
{res}opportunity_diabetes_1 opportunity_diabetes_2 ... opportunity_diabetes_4{txt}->{res}opportunity_diabetes_
success_diabetes_1 success_diabetes_2 ... success_diabetes_4{txt}->{res}success_diabetes_
{txt}{hline 77}
(13,340 observations deleted)
{res}{txt}(68 real changes made, 68 to missing)

Contains data
  obs:{res}        12,128                          
{txt} vars:{res}            10                          
{txt}Sorted by: {res}pregnancy  visit
     Note: Dataset has changed since last saved.
{txt}(variables nonmissing or string)
(variables nonmissing or string)
(variables nonmissing or string)
(variables nonmissing or string)
(variables nonmissing or string)
(variables nonmissing or string)
(variables nonmissing or string)
(variables nonmissing or string)
(variables nonmissing or string)
{col 64}Obs<.
{col 49}{c TLC}{hline 30}
{col 16}{c |}{col 49}{c |} Unique
{col 7}Variable {c |}{col 22}Obs=.{col 32}Obs>.{col 42}Obs<.{col 49}{c |} values{col 65}Min{col 77}Max
  {hline 13}{c +}{hline 32}{c +}{hline 30}
           age {c |}{res}       134{txt}{space 10}{res}    11,994{txt}  {c |}     32         14          45
  {hline 13}{c BT}{hline 32}{c BT}{hline 30}
(134 observations deleted)
{res}{txt}{col 8}panel variable:  {res}pregnancy (unbalanced)
{txt}{col 9}time variable:  {res}{col 25}visit, 1 to 4, but with gaps
{txt}{col 17}delta:  {res}1 unit
  6367:31(88392):1586201653:3483051938
{txt}(note: j = 1)

Data{col 36}wide{col 43}->{col 48}long
{hline 77}
Number of obs.                 {res}    6367   {txt}->{res}    6367
{txt}Number of variables            {res}      34   {txt}->{res}      35
{txt}j variable (1 values)                     ->   {res}visit
{txt}xij variables:
          {res}opportunity_malpresentation_1   {txt}->   {res}opportunity_malpresentation_
              success_malpresentation_1   {txt}->   {res}success_malpresentation_
{txt}{hline 77}
(4,427 observations deleted)
{res}{txt}(13 real changes made, 13 to missing)

Contains data
  obs:{res}         1,940                          
{txt} vars:{res}            10                          
{txt}Sorted by: {res}pregnancy  visit
     Note: Dataset has changed since last saved.
{txt}(variables nonmissing or string)
(variables nonmissing or string)
(variables nonmissing or string)
(variables nonmissing or string)
(variables nonmissing or string)
(variables nonmissing or string)
(variables nonmissing or string)
(variables nonmissing or string)
(variables nonmissing or string)
{col 64}Obs<.
{col 49}{c TLC}{hline 30}
{col 16}{c |}{col 49}{c |} Unique
{col 7}Variable {c |}{col 22}Obs=.{col 32}Obs>.{col 42}Obs<.{col 49}{c |} values{col 65}Min{col 77}Max
  {hline 13}{c +}{hline 32}{c +}{hline 30}
           age {c |}{res}        21{txt}{space 10}{res}     1,919{txt}  {c |}     30         15          44
  {hline 13}{c BT}{hline 32}{c BT}{hline 30}
(21 observations deleted)
{col 8}panel variable:  {res}clusterid (unbalanced)
  6367:51(74410):3453863737:2485498443
{txt}(note: j = 1 2 3 4 5)

Data{col 36}wide{col 43}->{col 48}long
{hline 77}
Number of obs.                 {res}    6367   {txt}->{res}   31835
{txt}Number of variables            {res}      54   {txt}->{res}      47
{txt}j variable (5 values)                     ->   {res}visit
{txt}xij variables:
{res}opportunity_anemia_1 opportunity_anemia_2 ... opportunity_anemia_5{txt}->{res}opportunity_anemia_
success_anemia_1 success_anemia_2 ... success_anemia_5{txt}->{res}success_anemia_
{txt}{hline 77}
(21,333 observations deleted)
{res}{txt}(66 real changes made, 66 to missing)

Contains data
  obs:{res}        10,502                          
{txt} vars:{res}            10                          
{txt}Sorted by: {res}pregnancy  visit
     Note: Dataset has changed since last saved.
{txt}(variables nonmissing or string)
(variables nonmissing or string)
(variables nonmissing or string)
(variables nonmissing or string)
(variables nonmissing or string)
(variables nonmissing or string)
(variables nonmissing or string)
(variables nonmissing or string)
(variables nonmissing or string)
{col 64}Obs<.
{col 49}{c TLC}{hline 30}
{col 16}{c |}{col 49}{c |} Unique
{col 7}Variable {c |}{col 22}Obs=.{col 32}Obs>.{col 42}Obs<.{col 49}{c |} values{col 65}Min{col 77}Max
  {hline 13}{c +}{hline 32}{c +}{hline 30}
           age {c |}{res}       115{txt}{space 10}{res}    10,387{txt}  {c |}     32         14          45
  {hline 13}{c BT}{hline 32}{c BT}{hline 30}
(115 observations deleted)
{res}{txt}{col 8}panel variable:  {res}pregnancy (unbalanced)
{txt}{col 9}time variable:  {res}{col 25}visit, 1 to 5, but with gaps
{txt}{col 17}delta:  {res}1 unit
  6367:37(83879):2470058122:813121498
{txt}(note: j = 1 2 3)

Data{col 36}wide{col 43}->{col 48}long
{hline 77}
Number of obs.                 {res}    6367   {txt}->{res}   19101
{txt}Number of variables            {res}      40   {txt}->{res}      37
{txt}j variable (3 values)                     ->   {res}visit
{txt}xij variables:
{res}opportunity_fetalgrowth_1 opportunity_fetalgrowth_2 opportunity_fetalgrowth_3{txt}->{res}opportunity_fetalgrowth_
success_fetalgrowth_1 success_fetalgrowth_2 success_fetalgrowth_3{txt}->{res}success_fetalgrowth_
{txt}{hline 77}
(17,936 observations deleted)
{res}{txt}(4 real changes made, 4 to missing)

Contains data
  obs:{res}         1,165                          
{txt} vars:{res}            10                          
{txt}Sorted by: {res}pregnancy  visit
     Note: Dataset has changed since last saved.
{txt}(variables nonmissing or string)
(variables nonmissing or string)
(variables nonmissing or string)
(variables nonmissing or string)
(variables nonmissing or string)
(variables nonmissing or string)
(variables nonmissing or string)
(variables nonmissing or string)
(variables nonmissing or string)
{col 64}Obs<.
{col 49}{c TLC}{hline 30}
{col 16}{c |}{col 49}{c |} Unique
{col 7}Variable {c |}{col 22}Obs=.{col 32}Obs>.{col 42}Obs<.{col 49}{c |} values{col 65}Min{col 77}Max
  {hline 13}{c +}{hline 32}{c +}{hline 30}
           age {c |}{res}        10{txt}{space 10}{res}     1,155{txt}  {c |}     29         15          43
  {hline 13}{c BT}{hline 32}{c BT}{hline 30}
(10 observations deleted)
{res}{txt}{col 8}panel variable:  {res}pregnancy (unbalanced)
{txt}{col 9}time variable:  {res}{col 25}visit, 1 to 3, but with a gap
{txt}{col 17}delta:  {res}1 unit
{txt}
{com}. 
{txt}end of do-file

{com}. do data/birth_outcomes
{txt}
{com}. version 16.1
{txt}
{com}. 
. // Define the path to the data and the signature we expect it to have.
. local fname "data/raw/04May2020_eRegQual birth outcomes.dta"
{txt}
{com}. local signature "6367:756(27238):862839612:1580475191"
{txt}
{com}. 
. frame create original
{txt}
{com}. frame original {c -(}
.   // Load the data and check its signature is as expected.
.   use "`fname'", replace
.   datasignature
  {res}6367:756(27238):862839612:1580475191
{com}.   assert r(datasignature) == "`signature'"
. 
.   // Globals that specify the imputed and regular variables.
.   global imputeds
.   global regulars
. 
.   // Convert the arm variable from string to integer.
.   encode prettyExposure, generate(arm)
.   label variable arm Arm
.   label define birth_outcome_arm_label 1 "Intervention" 2 "Control"
.   label values arm birth_outcome_arm_label
.   fvset base 2 arm
.   global regulars $regulars arm
. 
.   // Convert the stratification variable from string to integer.
.   encode bookorgdistricthashed, generate(strat_var)
.   label variable strat_var District
.   fvset base 1 strat_var
.   global regulars $regulars strat_var
. 
.   // Rename and label the cluster identifier variable.
.   rename str_TRIAL_1_Cluster clusterid
{res}{com}.   label variable clusterid Cluster
.   global regulars $regulars clusterid
. 
.   // Rename the components of the composite outcome.
.   rename anemia_at_birth              y1
{res}{com}.   label variable                      y1 "Anemia at birth"
.   rename severehypertension_at_birth  y2
{res}{com}.   label variable                      y2 "Severe hypertension at birth"
.   rename sga_undetected_at_birth      y3
{res}{com}.   label variable                      y3 "SGA undetected at birth"
.   rename malpres_undetected           y4
{res}{com}.   label variable                      y4 "Malpresentation undetected at birth"
.   rename lga                          y5
{res}{com}.   label variable                      y5 "Large for gestational age"
. 
.   // Apply labels to the outcomes.
.   label define yes_no_label 0 "No" 1 "Yes"
.   label values y* yes_no_label
. 
.   // Age.
.   replace age = . if age <= 1 // Correct some mis-coded values of the age variable.
{txt}(35 real changes made, 35 to missing)
{com}.   label variable age "Age (years)"
.   global imputeds $imputeds age
. 
.   // BMI.
.   rename bookbmi bmi
{res}{com}.   replace bmi = . if bmi < 15 | bmi > 48 // Same policy as for categorical version.
{txt}(54 real changes made, 54 to missing)
{com}.   label variable bmi "Body mass index"
.   global imputeds $imputeds bmi
. 
.   // Education.
.   label variable education "Education (years)"
.   global imputeds $imputeds education
. 
.   // Income.
.   generate log_income = log(avgincome) // Log to approximately normalize.
{txt}(404 missing values generated)
{com}.   label variable log_income "Monthly household income (ILS; log scale)"
.   global imputeds $imputeds log_income
. 
.   // Lab availability.
.   label variable lab_available "Lab available"
.   label define lab_available_label 1 "Lab" 0 "No lab"
.   label values lab_available lab_available_label
.   global regulars $regulars lab_available
.   
.   // Generate an indicator for whether each woman is primiparous.
.   rename bookprimi primiparous
{res}{com}.   label variable primiparous   "Parity"
.   label define primiparous_label 1 "Primi" 0 "Multi"
.   label values primiparous primiparous_label
.   global imputeds $imputeds primiparous
. 
.   // Generate an indicator for stillbirth. Because this is a secondary outcome
.   // and data are missing for <5% of women, we will not impute.
.   rename stillbirth_reported stillbirth
{res}{com}.   label variable stillbirth   "Stillbirth"
.   label define stillbirth_label 1 "Stillbirth" 0 "Live birth"
.   label values stillbirth stillbirth_label
.   
.   // Compute the cluster size from the trial data. We use the trial data for
.   // simplicity and have verified that these agree with the "baseline" data on
.   // trial size. We divide by 100 because cluster sizes range from about 10 to
.   // about 220, and we want to get regression coefficients that are non-null
.   // within two decimal places!
.   by clusterid, sort: generate cluster_size = _N / 100
.   global regulars $regulars cluster_size
. 
.   // Ultrasound available.
.   label variable us_available "US available"
.   global regulars $regulars us_available
. 
.   // Keep only the variables of interest.
.   keep y* $imputeds $regulars TrialOne_adverse_pregoutc stillbirth
. 
.   // Verify that all of the regular variables are complete, that each of the
.   // variables to be imputed contain missing values, and that the threshold on
.   // the percentage of missing data we tolerate to perform a complete case
.   // analysis applies to the stillbirth variable.
.   foreach x of global regulars {c -(}
{txt}  2{com}.     misstable summarize `x'
{txt}  3{com}.     assert r(N_lt_dot) == .
{txt}  4{com}.   {c )-}
{txt}(variables nonmissing or string)
(variables nonmissing or string)
(variables nonmissing or string)
(variables nonmissing or string)
(variables nonmissing or string)
(variables nonmissing or string)
{com}.   foreach x of varlist y1-y5 $imputeds {c -(}
{txt}  2{com}.     misstable summarize `x'
{txt}  3{com}.     assert r(N_lt_dot) < _N
{txt}  4{com}.   {c )-}
{txt}{col 64}Obs<.
{col 49}{c TLC}{hline 30}
{col 16}{c |}{col 49}{c |} Unique
{col 7}Variable {c |}{col 22}Obs=.{col 32}Obs>.{col 42}Obs<.{col 49}{c |} values{col 65}Min{col 77}Max
  {hline 13}{c +}{hline 32}{c +}{hline 30}
            y1 {c |}{res}     1,743{txt}{space 10}{res}     4,624{txt}  {c |}      2          0           1
  {hline 13}{c BT}{hline 32}{c BT}{hline 30}
{col 64}Obs<.
{col 49}{c TLC}{hline 30}
{col 16}{c |}{col 49}{c |} Unique
{col 7}Variable {c |}{col 22}Obs=.{col 32}Obs>.{col 42}Obs<.{col 49}{c |} values{col 65}Min{col 77}Max
  {hline 13}{c +}{hline 32}{c +}{hline 30}
            y2 {c |}{res}     2,258{txt}{space 10}{res}     4,109{txt}  {c |}      2          0           1
  {hline 13}{c BT}{hline 32}{c BT}{hline 30}
{col 64}Obs<.
{col 49}{c TLC}{hline 30}
{col 16}{c |}{col 49}{c |} Unique
{col 7}Variable {c |}{col 22}Obs=.{col 32}Obs>.{col 42}Obs<.{col 49}{c |} values{col 65}Min{col 77}Max
  {hline 13}{c +}{hline 32}{c +}{hline 30}
            y3 {c |}{res}       752{txt}{space 10}{res}     5,615{txt}  {c |}      2          0           1
  {hline 13}{c BT}{hline 32}{c BT}{hline 30}
{col 64}Obs<.
{col 49}{c TLC}{hline 30}
{col 16}{c |}{col 49}{c |} Unique
{col 7}Variable {c |}{col 22}Obs=.{col 32}Obs>.{col 42}Obs<.{col 49}{c |} values{col 65}Min{col 77}Max
  {hline 13}{c +}{hline 32}{c +}{hline 30}
            y4 {c |}{res}       875{txt}{space 10}{res}     5,492{txt}  {c |}      2          0           1
  {hline 13}{c BT}{hline 32}{c BT}{hline 30}
{col 64}Obs<.
{col 49}{c TLC}{hline 30}
{col 16}{c |}{col 49}{c |} Unique
{col 7}Variable {c |}{col 22}Obs=.{col 32}Obs>.{col 42}Obs<.{col 49}{c |} values{col 65}Min{col 77}Max
  {hline 13}{c +}{hline 32}{c +}{hline 30}
            y5 {c |}{res}       752{txt}{space 10}{res}     5,615{txt}  {c |}      2          0           1
  {hline 13}{c BT}{hline 32}{c BT}{hline 30}
{col 64}Obs<.
{col 49}{c TLC}{hline 30}
{col 16}{c |}{col 49}{c |} Unique
{col 7}Variable {c |}{col 22}Obs=.{col 32}Obs>.{col 42}Obs<.{col 49}{c |} values{col 65}Min{col 77}Max
  {hline 13}{c +}{hline 32}{c +}{hline 30}
           age {c |}{res}        69{txt}{space 10}{res}     6,298{txt}  {c |}     32         14          45
  {hline 13}{c BT}{hline 32}{c BT}{hline 30}
{col 64}Obs<.
{col 49}{c TLC}{hline 30}
{col 16}{c |}{col 49}{c |} Unique
{col 7}Variable {c |}{col 22}Obs=.{col 32}Obs>.{col 42}Obs<.{col 49}{c |} values{col 65}Min{col 77}Max
  {hline 13}{c +}{hline 32}{c +}{hline 30}
           bmi {c |}{res}       938{txt}{space 10}{res}     5,429{txt}  {c |}   >500   15.42969    47.98243
  {hline 13}{c BT}{hline 32}{c BT}{hline 30}
{col 64}Obs<.
{col 49}{c TLC}{hline 30}
{col 16}{c |}{col 49}{c |} Unique
{col 7}Variable {c |}{col 22}Obs=.{col 32}Obs>.{col 42}Obs<.{col 49}{c |} values{col 65}Min{col 77}Max
  {hline 13}{c +}{hline 32}{c +}{hline 30}
     education {c |}{res}       203{txt}{space 10}{res}     6,164{txt}  {c |}     25          1          24
  {hline 13}{c BT}{hline 32}{c BT}{hline 30}
{col 64}Obs<.
{col 49}{c TLC}{hline 30}
{col 16}{c |}{col 49}{c |} Unique
{col 7}Variable {c |}{col 22}Obs=.{col 32}Obs>.{col 42}Obs<.{col 49}{c |} values{col 65}Min{col 77}Max
  {hline 13}{c +}{hline 32}{c +}{hline 30}
    log_income {c |}{res}       404{txt}{space 10}{res}     5,963{txt}  {c |}    222  -5.926926    8.922658
  {hline 13}{c BT}{hline 32}{c BT}{hline 30}
{col 64}Obs<.
{col 49}{c TLC}{hline 30}
{col 16}{c |}{col 49}{c |} Unique
{col 7}Variable {c |}{col 22}Obs=.{col 32}Obs>.{col 42}Obs<.{col 49}{c |} values{col 65}Min{col 77}Max
  {hline 13}{c +}{hline 32}{c +}{hline 30}
   primiparous {c |}{res}       119{txt}{space 10}{res}     6,248{txt}  {c |}      2          0           1
  {hline 13}{c BT}{hline 32}{c BT}{hline 30}
{com}.   misstable summarize stillbirth
{txt}{col 64}Obs<.
{col 49}{c TLC}{hline 30}
{col 16}{c |}{col 49}{c |} Unique
{col 7}Variable {c |}{col 22}Obs=.{col 32}Obs>.{col 42}Obs<.{col 49}{c |} values{col 65}Min{col 77}Max
  {hline 13}{c +}{hline 32}{c +}{hline 30}
    stillbirth {c |}{res}       279{txt}{space 10}{res}     6,088{txt}  {c |}      2          0           1
  {hline 13}{c BT}{hline 32}{c BT}{hline 30}
{com}.   assert r(N_eq_dot) / (r(N_eq_dot) + r(N_lt_dot)) < 0.05
. {c )-}
{txt}
{com}. 
{txt}end of do-file

{com}. 
. // Perform imputation.
. // TODO: REINSTATE do data/impute
. 
. // Do estimation.
. // TODO: REINSTATE do estimation/missing          // Calculate percentage of data missing.
. do estimation/mcar             // Test the MCAR hypothesis.
{txt}
{com}. version 16.1
{txt}
{com}. 
. // Test the null hypothesis that the constituent outcomes are jointly MCAR, and
. // the null that the constituent outcomes are jointly CDM (a type of MCAR).
. // P < 0.05 would reject the hypotheses (i.e., as usual, if P>= 0.05, we cannot
. // "conclude" that the data are MCAR or have CDM, merely that we cannot reject
. // those hypotheses).
. frame original {c -(}
.   mcartest y1-y5
{res}{txt}{p 0 6}note: 560 {txt}observations {txt}omitted from EM estimation because of all {txt}imputation variables missing{p_end}
{res}
{txt}Little's MCAR test

Number of obs       = {res}5807
{txt}Chi-square distance = {res}42.4844     
{txt}Degrees of freedom  = {res}34
{txt}Prob > chi-square   = {res}0.1507
{com}.   global p_mcar = r(p)
.   mcartest y1-y5 = i.arm i.strat_var
{res}{txt}{p 0 6}note: 560 {txt}observations {txt}omitted from EM estimation because of all {txt}imputation variables missing{p_end}
{res}
{txt}Little's CDM test

Number of obs       = {res}5807
{txt}Chi-square distance = {res}196.2496    
{txt}Degrees of freedom  = {res}204
{txt}Prob > chi-square   = {res}0.6389
{com}.   global p_cdm  = r(p)
. {c )-}
{txt}
{com}. 
. 
{txt}end of do-file

{com}. // TODO: REINSTATE do estimation/birth_outcomes   // Analyze the birth outcome data.
. // TODO: REINSTATE do estimation/process_outcomes // Analyze process outcome data.
. // TODO: REINSTATE do estimation/margins          // Compute marginal probabilities.
. 
. // Make figures
. // TODO: REINSTATE do figures/imputation
. // TODO: REINSTATE do figures/margins
. 
. // Obtain the git revision hash, which is used in the reports.
. tempfile git_revision_filename
{txt}
{com}. tempname revision_file
{txt}
{com}. shell git rev-parse --short HEAD > "`git_revision_filename'"
{txt}

{com}. file open `revision_file' using `git_revision_filename', read text
{txt}
{com}. file read `revision_file' line
{txt}
{com}. global git_revision = "`macval(line)'"
{txt}
{com}. 
. // Make the report
. // TODO: REINSTATE do reports/report products/report.docx
. 
{txt}end of do-file

{com}. clear all
{res}
{com}. use "data/raw/05August2020_eRegTime.dta"

. datasignature
  {res}241:24(68218):3592272240:210409283

{com}. codebook prettyExposure
{err}variable {bf}prettyExposure{sf} not found
{txt}{search r(111), local:r(111);}

{com}. codebook Exposure
{err}variable {bf}Exposure{sf} not found
{txt}{search r(111), local:r(111);}

{com}. codebook exposure

{txt}{hline}
{res}exposure{right:Exposure}
{txt}{hline}

{col 19}type:  string ({res}str1{txt})

{col 10}unique values:  {res}2{col 51}{txt}missing "":  {res}0{txt}/{res}241

{txt}{col 13}tabulation:  Freq.  Value
{col 21}{res}       118{col 33}"A"
{col 21}       123{col 33}"B"

{com}. by clinicnumber, sort: generate cluster_size = _N / 100

. summarize cluster_size 

{txt}    Variable {c |}        Obs        Mean    Std. Dev.       Min        Max
{hline 13}{c +}{hline 57}
cluster_size {c |}{res}        241    .1260996    .0539032        .04        .26

{com}. codebook

{txt}{hline}
{res}clinicnumber{right:Clinic number}
{txt}{hline}

{col 19}type:  numeric ({res}byte{txt})

{col 18}range:  [{res}1{txt},{res}22{txt}]{col 55}units:  {res}1
{col 10}{txt}unique values:  {res}22{col 51}{txt}missing .:  {res}0{txt}/{res}241

{txt}{col 19}mean:{res}{col 26} 11.1577
{txt}{col 15}std. dev:{res}{col 26}  6.4511

{txt}{col 12}percentiles:{col 32}10%{col 42}25%{col 52}50%{col 62}75%{col 72}90%
{res}{col 27}       2{col 37}       6{col 47}      11{col 57}      17{col 67}      20

{txt}{hline}
{res}observationnumber{right:Observation number}
{txt}{hline}

{col 19}type:  numeric ({res}int{txt})

{col 18}range:  [{res}1{txt},{res}241{txt}]{col 55}units:  {res}1
{col 10}{txt}unique values:  {res}241{col 51}{txt}missing .:  {res}0{txt}/{res}241

{txt}{col 19}mean:{res}{col 26}     121
{txt}{col 15}std. dev:{res}{col 26} 69.7149

{txt}{col 12}percentiles:{col 32}10%{col 42}25%{col 52}50%{col 62}75%{col 72}90%
{res}{col 27}      25{col 37}      61{col 47}     121{col 57}     181{col 67}     217

{txt}{hline}
{res}consultationtime{right:consultation time }
{txt}{hline}

{col 19}type:  numeric ({res}double{txt})

{col 18}range:  [{res}2.0666667{txt},{res}38.683333{txt}]{col 55}units:  {res}1.000e-08
{col 10}{txt}unique values:  {res}233{col 51}{txt}missing .:  {res}0{txt}/{res}241

{txt}{col 19}mean:{res}{col 26} 12.6095
{txt}{col 15}std. dev:{res}{col 26} 7.34145

{txt}{col 12}percentiles:{col 32}10%{col 42}25%{col 52}50%{col 62}75%{col 72}90%
{res}{col 27} 5.41667{col 37} 7.11667{col 47}    10.4{col 57} 16.2167{col 67} 24.2667

{txt}{hline}
{res}himwithinconsultation{right:HIM within consultation}
{txt}{hline}

{col 19}type:  numeric ({res}double{txt})

{col 18}range:  [{res}.81666667{txt},{res}34.383333{txt}]{col 55}units:  {res}1.000e-08
{col 10}{txt}unique values:  {res}226{col 51}{txt}missing .:  {res}0{txt}/{res}241

{txt}{col 19}mean:{res}{col 26} 7.07415
{txt}{col 15}std. dev:{res}{col 26} 4.92212

{txt}{col 12}percentiles:{col 32}10%{col 42}25%{col 52}50%{col 62}75%{col 72}90%
{res}{col 27} 2.73333{col 37} 3.73333{col 47}    5.55{col 57} 8.38333{col 67} 14.2667

{txt}{hline}
{res}clientcarewithinconsultation{right:Client care within consultation}
{txt}{hline}

{col 19}type:  numeric ({res}double{txt})

{col 18}range:  [{res}.15{txt},{res}21.616667{txt}]{col 55}units:  {res}1.000e-08
{col 10}{txt}unique values:  {res}226{col 51}{txt}missing .:  {res}4{txt}/{res}241

{txt}{col 19}mean:{res}{col 26} 4.96398
{txt}{col 15}std. dev:{res}{col 26}  3.7884

{txt}{col 12}percentiles:{col 32}10%{col 42}25%{col 52}50%{col 62}75%{col 72}90%
{res}{col 27}     1.3{col 37}    2.55{col 47}    3.85{col 57}     6.4{col 67}    10.8

{txt}{hline}
{res}miscellaneouswithinconsultatio{right:Miscellaneous within consultation}
{txt}{hline}

{col 19}type:  numeric ({res}double{txt})

{col 18}range:  [{res}.13333333{txt},{res}7.6333333{txt}]{col 55}units:  {res}1.000e-09
{col 10}{txt}unique values:  {res}78{col 51}{txt}missing .:  {res}157{txt}/{res}241

{txt}{col 19}mean:{res}{col 26} 1.84786
{txt}{col 15}std. dev:{res}{col 26} 1.63232

{txt}{col 12}percentiles:{col 32}10%{col 42}25%{col 52}50%{col 62}75%{col 72}90%
{res}{col 27} .383333{col 37}    .575{col 47} 1.29167{col 57}   2.625{col 67} 4.43333

{txt}{hline}
{res}bookingvisit{right:Booking visit }
{txt}{hline}

{col 19}type:  numeric ({res}byte{txt})

{col 18}range:  [{res}0{txt},{res}1{txt}]{col 55}units:  {res}1
{col 10}{txt}unique values:  {res}2{col 51}{txt}missing .:  {res}1{txt}/{res}241

{txt}{col 13}tabulation:  Freq.  Value
{col 21}{res}       210{col 33}0
{col 21}        30{col 33}1
{col 21}         1{col 33}.

{txt}{hline}
{res}observercode{right:Observer code}
{txt}{hline}

{col 19}type:  numeric ({res}byte{txt})

{col 18}range:  [{res}1{txt},{res}4{txt}]{col 55}units:  {res}1
{col 10}{txt}unique values:  {res}4{col 51}{txt}missing .:  {res}0{txt}/{res}241

{txt}{col 13}tabulation:  Freq.  Value
{col 21}{res}        46{col 33}1
{col 21}        84{col 33}2
{col 21}        40{col 33}3
{col 21}        71{col 33}4

{txt}{hline}
{res}afterconsultationhim{right:after consultation HIM}
{txt}{hline}

{col 19}type:  numeric ({res}double{txt})

{col 18}range:  [{res}0{txt},{res}28.13{txt}]{col 55}units:  {res}1.000e-08
{col 10}{txt}unique values:  {res}10{col 51}{txt}missing .:  {res}115{txt}/{res}241

{txt}{col 19}mean:{res}{col 26} 2.17315
{txt}{col 15}std. dev:{res}{col 26} 4.88833

{txt}{col 12}percentiles:{col 32}10%{col 42}25%{col 52}50%{col 62}75%{col 72}90%
{res}{col 27} .116667{col 37}     .53{col 47} .932051{col 57}     1.7{col 67}    5.03

{txt}{hline}
{res}afterconsultationmiscellaneous{right:after consultation miscellaneous}
{txt}{hline}

{col 19}type:  numeric ({res}double{txt})

{col 18}range:  [{res}1.365{txt},{res}60.99{txt}]{col 55}units:  {res}1.000e-07
{col 10}{txt}unique values:  {res}21{col 51}{txt}missing .:  {res}10{txt}/{res}241

{txt}{col 19}mean:{res}{col 26} 13.6769
{txt}{col 15}std. dev:{res}{col 26} 14.0151

{txt}{col 12}percentiles:{col 32}10%{col 42}25%{col 52}50%{col 62}75%{col 72}90%
{res}{col 27} 2.81795{col 37}    3.03{col 47}    9.76{col 57}   16.12{col 67}   39.71

{txt}{hline}
{res}clientrelatedcare{right:client-related care }
{txt}{hline}

{col 19}type:  numeric ({res}double{txt})

{col 18}range:  [{res}3.59{txt},{res}14.17{txt}]{col 55}units:  {res}.01
{col 10}{txt}unique values:  {res}2{col 51}{txt}missing .:  {res}220{txt}/{res}241

{txt}{col 13}tabulation:  Freq.  Value
{col 21}{res}        13{col 33}3.59
{col 21}         8{col 33}14.17
{col 21}       220{col 33}.

{txt}{hline}
{res}himperconsultation{right:HIM per consultation}
{txt}{hline}

{col 19}type:  numeric ({res}double{txt})

{col 18}range:  [{res}.81666667{txt},{res}51.913333{txt}]{col 55}units:  {res}1.000e-08
{col 10}{txt}unique values:  {res}237{col 51}{txt}missing .:  {res}0{txt}/{res}241

{txt}{col 19}mean:{res}{col 26} 8.21032
{txt}{col 15}std. dev:{res}{col 26} 6.59417

{txt}{col 12}percentiles:{col 32}10%{col 42}25%{col 52}50%{col 62}75%{col 72}90%
{res}{col 27} 3.30833{col 37} 4.58333{col 47} 6.34872{col 57}    9.41{col 67} 14.8833

{txt}{hline}
{res}exposure{right:Exposure}
{txt}{hline}

{col 19}type:  string ({res}str1{txt})

{col 10}unique values:  {res}2{col 51}{txt}missing "":  {res}0{txt}/{res}241

{txt}{col 13}tabulation:  Freq.  Value
{col 21}{res}       118{col 33}"A"
{col 21}       123{col 33}"B"

{txt}{hline}
{res}paperfindhim{right:Paper find HIM}
{txt}{hline}

{col 19}type:  numeric ({res}double{txt})

{col 18}range:  [{res}.08333333{txt},{res}6.0333333{txt}]{col 55}units:  {res}1.000e-09
{col 10}{txt}unique values:  {res}76{col 51}{txt}missing .:  {res}139{txt}/{res}241

{txt}{col 19}mean:{res}{col 26}  .68219
{txt}{col 15}std. dev:{res}{col 26} .823821

{txt}{col 12}percentiles:{col 32}10%{col 42}25%{col 52}50%{col 62}75%{col 72}90%
{res}{col 27} .133333{col 37}      .2{col 47} .383333{col 57} .966667{col 67} 1.71667

{txt}{hline}
{res}paperreadhim{right:Paper read HIM}
{txt}{hline}

{col 19}type:  numeric ({res}double{txt})

{col 18}range:  [{res}.11666667{txt},{res}10.366667{txt}]{col 55}units:  {res}1.000e-09
{col 10}{txt}unique values:  {res}72{col 51}{txt}missing .:  {res}155{txt}/{res}241

{txt}{col 19}mean:{res}{col 26} 1.13081
{txt}{col 15}std. dev:{res}{col 26} 1.56271

{txt}{col 12}percentiles:{col 32}10%{col 42}25%{col 52}50%{col 62}75%{col 72}90%
{res}{col 27} .216667{col 37} .266667{col 47} .483333{col 57}    1.45{col 67} 2.53333

{txt}{hline}
{res}paperwritinghim{right:Paper writing HIM}
{txt}{hline}

{col 19}type:  numeric ({res}double{txt})

{col 18}range:  [{res}.18333333{txt},{res}25.716667{txt}]{col 55}units:  {res}1.000e-09
{col 10}{txt}unique values:  {res}205{col 51}{txt}missing .:  {res}21{txt}/{res}241

{txt}{col 19}mean:{res}{col 26} 4.16212
{txt}{col 15}std. dev:{res}{col 26} 4.61567

{txt}{col 12}percentiles:{col 32}10%{col 42}25%{col 52}50%{col 62}75%{col 72}90%
{res}{col 27}    .575{col 37} 1.19167{col 47} 2.73333{col 57} 5.46667{col 67} 8.68333

{txt}{hline}
{res}computerfindhim{right:Computer find HIM}
{txt}{hline}

{col 19}type:  numeric ({res}double{txt})

{col 18}range:  [{res}.11666667{txt},{res}7.2333333{txt}]{col 55}units:  {res}1.000e-09
{col 10}{txt}unique values:  {res}93{col 51}{txt}missing .:  {res}126{txt}/{res}241

{txt}{col 19}mean:{res}{col 26} .908696
{txt}{col 15}std. dev:{res}{col 26} .844231

{txt}{col 12}percentiles:{col 32}10%{col 42}25%{col 52}50%{col 62}75%{col 72}90%
{res}{col 27} .216667{col 37} .416667{col 47} .716667{col 57}     1.2{col 67} 1.66667

{txt}{hline}
{res}computerreadhim{right:Computer read HIM}
{txt}{hline}

{col 19}type:  numeric ({res}double{txt})

{col 18}range:  [{res}.15{txt},{res}1.9{txt}]{col 55}units:  {res}1.000e-09
{col 10}{txt}unique values:  {res}28{col 51}{txt}missing .:  {res}208{txt}/{res}241

{txt}{col 19}mean:{res}{col 26} .641919
{txt}{col 15}std. dev:{res}{col 26} .513483

{txt}{col 12}percentiles:{col 32}10%{col 42}25%{col 52}50%{col 62}75%{col 72}90%
{res}{col 27} .216667{col 37} .233333{col 47} .433333{col 57}      .8{col 67} 1.56667

{txt}{hline}
{res}computerwritinghim{right:Computer writing HIM}
{txt}{hline}

{col 19}type:  numeric ({res}double{txt})

{col 18}range:  [{res}.73333333{txt},{res}15.233333{txt}]{col 55}units:  {res}1.000e-08
{col 10}{txt}unique values:  {res}121{col 51}{txt}missing .:  {res}119{txt}/{res}241

{txt}{col 19}mean:{res}{col 26} 3.99303
{txt}{col 15}std. dev:{res}{col 26}  2.9324

{txt}{col 12}percentiles:{col 32}10%{col 42}25%{col 52}50%{col 62}75%{col 72}90%
{res}{col 27} 1.21667{col 37} 1.88333{col 47} 3.23333{col 57}     5.1{col 67} 8.48333

{txt}{hline}
{res}talkinghim{right:Talking HIM}
{txt}{hline}

{col 19}type:  numeric ({res}double{txt})

{col 18}range:  [{res}.25{txt},{res}1.7{txt}]{col 55}units:  {res}1.000e-08
{col 10}{txt}unique values:  {res}6{col 51}{txt}missing .:  {res}234{txt}/{res}241

{txt}{col 13}tabulation:  Freq.  Value
{col 21}{res}         1{col 33}.25
{col 21}         1{col 33}.38333333
{col 21}         2{col 33}.48333333
{col 21}         1{col 33}.63333333
{col 21}         1{col 33}.8
{col 21}         1{col 33}1.7
{col 21}       234{col 33}.

{txt}{hline}
{res}proceduresclientcare{right:Procedures client care}
{txt}{hline}

{col 19}type:  numeric ({res}double{txt})

{col 18}range:  [{res}.15{txt},{res}21.4{txt}]{col 55}units:  {res}1.000e-09
{col 10}{txt}unique values:  {res}203{col 51}{txt}missing .:  {res}16{txt}/{res}241

{txt}{col 19}mean:{res}{col 26} 2.93126
{txt}{col 15}std. dev:{res}{col 26} 2.31343

{txt}{col 12}percentiles:{col 32}10%{col 42}25%{col 52}50%{col 62}75%{col 72}90%
{res}{col 27}       1{col 37}    1.55{col 47} 2.36667{col 57} 3.71667{col 67} 5.16667

{txt}{hline}
{res}talkingclientcare{right:Talking client care}
{txt}{hline}

{col 19}type:  numeric ({res}double{txt})

{col 18}range:  [{res}.2{txt},{res}10.383333{txt}]{col 55}units:  {res}1.000e-09
{col 10}{txt}unique values:  {res}147{col 51}{txt}missing .:  {res}79{txt}/{res}241

{txt}{col 19}mean:{res}{col 26} 2.10144
{txt}{col 15}std. dev:{res}{col 26} 1.98807

{txt}{col 12}percentiles:{col 32}10%{col 42}25%{col 52}50%{col 62}75%{col 72}90%
{res}{col 27}      .4{col 37} .733333{col 47} 1.50833{col 57}    2.65{col 67} 4.76667

{txt}{hline}
{res}outsideclientcare{right:Outside client care}
{txt}{hline}

{col 19}type:  numeric ({res}double{txt})

{col 18}range:  [{res}.26666667{txt},{res}20.35{txt}]{col 55}units:  {res}1.000e-09
{col 10}{txt}unique values:  {res}40{col 51}{txt}missing .:  {res}200{txt}/{res}241

{txt}{col 19}mean:{res}{col 26} 3.63659
{txt}{col 15}std. dev:{res}{col 26} 4.17714

{txt}{col 12}percentiles:{col 32}10%{col 42}25%{col 52}50%{col 62}75%{col 72}90%
{res}{col 27} .516667{col 37} .766667{col 47} 2.38333{col 57} 5.21667{col 67}     7.2

{txt}{hline}
{res}lab_available{right:(unlabeled)}
{txt}{hline}

{col 19}type:  numeric ({res}float{txt})

{col 18}range:  [{res}0{txt},{res}1{txt}]{col 55}units:  {res}1
{col 10}{txt}unique values:  {res}2{col 51}{txt}missing .:  {res}0{txt}/{res}241

{txt}{col 13}tabulation:  Freq.  Value
{col 21}{res}       147{col 33}0
{col 21}        94{col 33}1

{txt}{hline}
{res}cluster_size{right:(unlabeled)}
{txt}{hline}

{col 19}type:  numeric ({res}float{txt})

{col 18}range:  [{res}.04{txt},{res}.26{txt}]{col 55}units:  {res}.01
{col 10}{txt}unique values:  {res}11{col 51}{txt}missing .:  {res}0{txt}/{res}241

{txt}{col 19}mean:{res}{col 26}   .1261
{txt}{col 15}std. dev:{res}{col 26} .053903

{txt}{col 12}percentiles:{col 32}10%{col 42}25%{col 52}50%{col 62}75%{col 72}90%
{res}{col 27}     .08{col 37}     .09{col 47}     .11{col 57}     .13{col 67}     .26

{com}. describe

{txt}Contains data from {res}data/raw/05August2020_eRegTime.dta
{txt}  obs:{res}           241                          
{txt} vars:{res}            25                          5 Aug 2020 15:32
{txt}{hline}
              storage   display    value
variable name   type    format     label      variable label
{hline}
{p 0 48}{res}{bind:clinicnumber   }{txt}{bind: byte    }{bind:{txt}%10.0g    }{space 1}{bind:         }{bind:  }{res}{res}Clinic number{p_end}
{p 0 48}{bind:observationnu~r}{txt}{bind: int     }{bind:{txt}%10.0g    }{space 1}{bind:         }{bind:  }{res}{res}Observation number{p_end}
{p 0 48}{bind:consultationt~e}{txt}{bind: double  }{bind:{txt}%14.2f    }{space 1}{bind:         }{bind:  }{res}{res}consultation time {p_end}
{p 0 48}{bind:himwithincons~n}{txt}{bind: double  }{bind:{txt}%14.2f    }{space 1}{bind:         }{bind:  }{res}{res}HIM within consultation{p_end}
{p 0 48}{bind:clientcarewit~n}{txt}{bind: double  }{bind:{txt}%14.2f    }{space 1}{bind:         }{bind:  }{res}{res}Client care within consultation{p_end}
{p 0 48}{bind:miscellaneous~o}{txt}{bind: double  }{bind:{txt}%14.2f    }{space 1}{bind:         }{bind:  }{res}{res}Miscellaneous within consultation{p_end}
{p 0 48}{bind:bookingvisit   }{txt}{bind: byte    }{bind:{txt}%10.0g    }{space 1}{bind:         }{bind:  }{res}{res}Booking visit {p_end}
{p 0 48}{bind:observercode   }{txt}{bind: byte    }{bind:{txt}%10.0g    }{space 1}{bind:         }{bind:  }{res}{res}Observer code{p_end}
{p 0 48}{bind:afterconsulta~m}{txt}{bind: double  }{bind:{txt}%14.2f    }{space 1}{bind:         }{bind:  }{res}{res}after consultation HIM{p_end}
{p 0 48}{bind:afterconsulta~s}{txt}{bind: double  }{bind:{txt}%14.2f    }{space 1}{bind:         }{bind:  }{res}{res}after consultation miscellaneous{p_end}
{p 0 48}{bind:clientrelated~e}{txt}{bind: double  }{bind:{txt}%14.2f    }{space 1}{bind:         }{bind:  }{res}{res}client-related care {p_end}
{p 0 48}{bind:himperconsult~n}{txt}{bind: double  }{bind:{txt}%14.2f    }{space 1}{bind:         }{bind:  }{res}{res}HIM per consultation{p_end}
{p 0 48}{bind:exposure       }{txt}{bind: str1    }{bind:{txt}%9s       }{space 1}{bind:         }{bind:  }{res}{res}Exposure{p_end}
{p 0 48}{bind:paperfindhim   }{txt}{bind: double  }{bind:{txt}%14.2f    }{space 1}{bind:         }{bind:  }{res}{res}Paper find HIM{p_end}
{p 0 48}{bind:paperreadhim   }{txt}{bind: double  }{bind:{txt}%14.2f    }{space 1}{bind:         }{bind:  }{res}{res}Paper read HIM{p_end}
{p 0 48}{bind:paperwritinghim}{txt}{bind: double  }{bind:{txt}%14.2f    }{space 1}{bind:         }{bind:  }{res}{res}Paper writing HIM{p_end}
{p 0 48}{bind:computerfindhim}{txt}{bind: double  }{bind:{txt}%14.2f    }{space 1}{bind:         }{bind:  }{res}{res}Computer find HIM{p_end}
{p 0 48}{bind:computerreadhim}{txt}{bind: double  }{bind:{txt}%14.2f    }{space 1}{bind:         }{bind:  }{res}{res}Computer read HIM{p_end}
{p 0 48}{bind:computerwriti~m}{txt}{bind: double  }{bind:{txt}%14.2f    }{space 1}{bind:         }{bind:  }{res}{res}Computer writing HIM{p_end}
{p 0 48}{bind:talkinghim     }{txt}{bind: double  }{bind:{txt}%10.0g    }{space 1}{bind:         }{bind:  }{res}{res}Talking HIM{p_end}
{p 0 48}{bind:procedurescli~e}{txt}{bind: double  }{bind:{txt}%14.2f    }{space 1}{bind:         }{bind:  }{res}{res}Procedures client care{p_end}
{p 0 48}{bind:talkingclient~e}{txt}{bind: double  }{bind:{txt}%14.2f    }{space 1}{bind:         }{bind:  }{res}{res}Talking client care{p_end}
{p 0 48}{bind:outsideclient~e}{txt}{bind: double  }{bind:{txt}%14.2f    }{space 1}{bind:         }{bind:  }{res}{res}Outside client care{p_end}
{p 0 48}{bind:lab_available  }{txt}{bind: float   }{bind:{txt}%9.0g     }{space 1}{bind:         }{bind:  }{res}{res}{p_end}
{p 0 48}{bind:cluster_size   }{txt}{bind: float   }{bind:{txt}%9.0g     }{space 1}{bind:         }{bind:  }{res}{res}{p_end}
{txt}{hline}
Sorted by: {res}clinicnumber
     Note: Dataset has changed since last saved.

{com}. clear all
{res}
{com}. do globals/globals
{txt}
{com}. version 16.1
{txt}
{com}. 
. // The number of imputations to perform.
. global m_imputations 50 // Very slightly narrower CI if m=100.
{txt}
{com}. 
. // Define the names of the process outcomes.
. global process_outcomes ""
{txt}
{com}. global process_outcomes $process_outcomes attendance hypertension diabetes
{txt}
{com}. global process_outcomes $process_outcomes malpresentation anemia fetalgrowth
{txt}
{com}. 
. // Define the names of the time outcomes.
. global time_outcomes ""
{txt}
{com}. global time_outcomes $time_outcomes info_management
{txt}
{com}. 
. // The variables to adjust for, with their "types". See the generated report for
. // an explanation of why these variables are adjusted for.
. global adj_vars i.strat_var c.cluster_size c.age i.lab_available i.primiparous
{txt}
{com}. global adj_var_names // A global with just the *names* of the adj_vars
{txt}
{com}. foreach x of global adj_vars {c -(}
{txt}  2{com}.   local x_name = substr("`x'", 3, .) // Remove the i. or c.
{txt}  3{com}.   global adj_var_names $adj_var_names `x_name'
{txt}  4{com}. {c )-}
{txt}
{com}. 
. // Define paths to the process outcome files.
. global fname_attendance      "data/raw/25June2020_eRegQual process outcomes_attendance.dta"
{txt}
{com}. global fname_hypertension    "data/raw/25June2020_eRegQual process outcomes_hypertension.dta"
{txt}
{com}. global fname_diabetes        "data/raw/25June2020_eRegQual process outcomes_diabetes.dta"
{txt}
{com}. global fname_malpresentation "data/raw/25June2020_eRegQual process outcomes_malpresentation.dta"
{txt}
{com}. global fname_anemia          "data/raw/02July2020_eRegQual process outcomes_anemia.dta"
{txt}
{com}. global fname_fetalgrowth     "data/raw/10August2020_eRegQual process outcomes_fetalgrowth.dta"
{txt}
{com}. 
. // Define paths to the time outcome file.
. global fname_time            "data/raw/05August2020_eRegTime.dta"
{txt}
{com}. 
. // Define data signatures for the process outcome files.
. global datasignature_attendance          "6367:39(51496):3578513271:2127801624"
{txt}
{com}. global datasignature_hypertension        "6367:60(68365):3970041110:3735367683"
{txt}
{com}. global datasignature_diabetes            "6367:38(91264):1895688975:3113856828"
{txt}
{com}. global datasignature_malpresentation     "6367:31(88392):1586201653:3483051938"
{txt}
{com}. global datasignature_anemia              "6367:51(74410):3453863737:2485498443"
{txt}
{com}. global datasignature_fetalgrowth         "6367:37(83879):2470058122:813121498"
{txt}
{com}. 
. // Define data signature for the time data.
. global datasignature_time                "241:24(68218):3592272240:210409283"
{txt}
{com}. 
. // Define recoding rules for the arm variables of the process outcomes; the 
. // coding of control and intervention vary by outcome. We will adopt the 
. // convention that control is coded as 1 and intervention as 2.
. global recode_attendance   recode arm (1 = 2) (2 = 1)
{txt}
{com}. global recode_hypertension recode arm (1 = 2) (2 = 1)
{txt}
{com}. foreach x in diabetes malpresentation anemia fetalgrowth {c -(}
{txt}  2{com}.   global recode_`x' // No recoding necessary
{txt}  3{com}. {c )-}
{txt}
{com}. 
{txt}end of do-file

{com}. do data/time_outcomes
{txt}
{com}. version 16.1
{txt}
{com}. 
. // Load the data and check its signature is as expected.
. frame create time
{txt}
{com}. frame time {c -(}
.   // Import the data and verify its signature.
.   use "${c -(}fname_time{c )-}", replace
.   datasignature
  {res}241:24(68218):3592272240:210409283
{com}.   assert r(datasignature) == "${c -(}datasignature_time{c )-}"
. 
.   // Encode/rename arm variable.
.   encode exposure, generate(arm)
.   label variable arm Arm
. 
.   // Rename cluster identifier variables.
.   rename clinicnumber clusterid
{res}{com}.   label variable clusterid Cluster
. 
.   // TODO: Need district as strat_var.
.   // TODO: Need age.
.   // TODO: Need primiparous
. 
.   // Lab availability.
.   label variable lab_available "Lab available"
.   label define lab_available_label 1 "Lab" 0 "No lab"
.   label values lab_available lab_available_label
. 
. 
.   // Compute the cluster size from the trial data. We use the trial data for
.   // simplicity and have verified that these agree with the "baseline" data on
.   // trial size. We divide by 100 because cluster sizes range from about 10 to
.   // about 220, and we want to get regression coefficients that are non-null
.   // within two decimal places! Note that cluster size computation must be
.   // done before the data set is reshaped to long format, or we will count
.   // one enrollment per visit rather than pregnancy.
.   by clusterid, sort: generate cluster_size = _N / 100
. {c )-}
{txt}
{com}. 
{txt}end of do-file

{com}. frame dir
{p2col 3 12 14 2:{txt}default }{res}0 {txt:{it:x}} 0
{p_end}
{p2col 1 12 14 2:{res}* {txt}time }{res}241 {txt:{it:x}} 26{txt:;} 05August2020_eRegTime.dta
{p_end}

{txt}Note: frames marked with {res:*} contain unsaved data

{com}. frame time: summarize

{txt}    Variable {c |}        Obs        Mean    Std. Dev.       Min        Max
{hline 13}{c +}{hline 57}
{space 3}clusterid {c |}{res}        241    11.15768    6.451101          1         22
{txt}observatio~r {c |}{res}        241         121     69.7149          1        241
{txt}consultati~e {c |}{res}        241    12.60954     7.34145   2.066667   38.68333
{txt}himwithinc~n {c |}{res}        241    7.074149    4.922118   .8166667   34.38333
{txt}clientcare~n {c |}{res}        237     4.96398    3.788403        .15   21.61667
{txt}{hline 13}{c +}{hline 57}
miscellane~o {c |}{res}         84    1.847857    1.632324   .1333333   7.633333
{txt}bookingvisit {c |}{res}        240        .125    .3314101          0          1
{txt}observercode {c |}{res}        241    2.564315     1.10539          1          4
{txt}afterconsu~m {c |}{res}        126    2.173148    4.888334          0      28.13
{txt}afterconsu~s {c |}{res}        231    13.67691     14.0151      1.365      60.99
{txt}{hline 13}{c +}{hline 57}
clientrela~e {c |}{res}         21    7.620476    5.264749       3.59      14.17
{txt}himpercons~n {c |}{res}        241    8.210318    6.594167   .8166667   51.91333
{txt}{space 4}exposure {c |}{res}          0
{txt}paperfindhim {c |}{res}        102    .6821895    .8238212   .0833333   6.033333
{txt}paperreadhim {c |}{res}         86    1.130814    1.562712   .1166667   10.36667
{txt}{hline 13}{c +}{hline 57}
paperwriti~m {c |}{res}        220    4.162121    4.615665   .1833333   25.71667
{txt}computerfi~m {c |}{res}        115    .9086957    .8442309   .1166667   7.233333
{txt}computerre~m {c |}{res}         33    .6419192    .5134835        .15        1.9
{txt}computerwr~m {c |}{res}        122    3.993033    2.932398   .7333333   15.23333
{txt}{space 2}talkinghim {c |}{res}          7    .6761905    .4842766        .25        1.7
{txt}{hline 13}{c +}{hline 57}
procedures~e {c |}{res}        225    2.931259    2.313427        .15       21.4
{txt}talkingcli~e {c |}{res}        162     2.10144    1.988074         .2   10.38333
{txt}outsidecli~e {c |}{res}         41    3.636585    4.177137   .2666667      20.35
{txt}lab_availa~e {c |}{res}        241    .3900415    .4887744          0          1
{txt}{space 9}arm {c |}{res}        241    1.510373    .5009327          1          2
{txt}{hline 13}{c +}{hline 57}
cluster_size {c |}{res}        241    .1260996    .0539032        .04        .26

{com}. do globals/globals
{txt}
{com}. version 16.1
{txt}
{com}. 
. // The number of imputations to perform.
. global m_imputations 50 // Very slightly narrower CI if m=100.
{txt}
{com}. 
. // Define the names of the process outcomes.
. global process_outcomes ""
{txt}
{com}. global process_outcomes $process_outcomes attendance hypertension diabetes
{txt}
{com}. global process_outcomes $process_outcomes malpresentation anemia fetalgrowth
{txt}
{com}. 
. // Define the names of the time outcomes.
. global time_outcomes ""
{txt}
{com}. global time_outcomes $time_outcomes info_management
{txt}
{com}. 
. // The variables to adjust for, with their "types". See the generated report for
. // an explanation of why these variables are adjusted for.
. global adj_vars i.strat_var c.cluster_size c.age i.lab_available i.primiparous
{txt}
{com}. global adj_var_names // A global with just the *names* of the adj_vars
{txt}
{com}. foreach x of global adj_vars {c -(}
{txt}  2{com}.   local x_name = substr("`x'", 3, .) // Remove the i. or c.
{txt}  3{com}.   global adj_var_names $adj_var_names `x_name'
{txt}  4{com}. {c )-}
{txt}
{com}. 
. // Define paths to the process outcome files.
. global fname_attendance      "data/raw/25June2020_eRegQual process outcomes_attendance.dta"
{txt}
{com}. global fname_hypertension    "data/raw/25June2020_eRegQual process outcomes_hypertension.dta"
{txt}
{com}. global fname_diabetes        "data/raw/25June2020_eRegQual process outcomes_diabetes.dta"
{txt}
{com}. global fname_malpresentation "data/raw/25June2020_eRegQual process outcomes_malpresentation.dta"
{txt}
{com}. global fname_anemia          "data/raw/02July2020_eRegQual process outcomes_anemia.dta"
{txt}
{com}. global fname_fetalgrowth     "data/raw/10August2020_eRegQual process outcomes_fetalgrowth.dta"
{txt}
{com}. 
. // Define paths to the time outcome file.
. global fname_time            "data/raw/05August2020_eRegTime.dta"
{txt}
{com}. 
. // Define data signatures for the process outcome files.
. global datasignature_attendance          "6367:39(51496):3578513271:2127801624"
{txt}
{com}. global datasignature_hypertension        "6367:60(68365):3970041110:3735367683"
{txt}
{com}. global datasignature_diabetes            "6367:38(91264):1895688975:3113856828"
{txt}
{com}. global datasignature_malpresentation     "6367:31(88392):1586201653:3483051938"
{txt}
{com}. global datasignature_anemia              "6367:51(74410):3453863737:2485498443"
{txt}
{com}. global datasignature_fetalgrowth         "6367:37(83879):2470058122:813121498"
{txt}
{com}. 
. // Define data signature for the time data.
. global datasignature_time                "241:24(68218):3592272240:210409283"
{txt}
{com}. 
. // Define recoding rules for the arm variables of the process outcomes; the 
. // coding of control and intervention vary by outcome. We will adopt the 
. // convention that control is coded as 1 and intervention as 2.
. global recode_attendance   recode arm (1 = 2) (2 = 1)
{txt}
{com}. global recode_hypertension recode arm (1 = 2) (2 = 1)
{txt}
{com}. foreach x in diabetes malpresentation anemia fetalgrowth {c -(}
{txt}  2{com}.   global recode_`x' // No recoding necessary
{txt}  3{com}. {c )-}
{txt}
{com}. 
{txt}end of do-file

{com}. clear all
{res}
{com}. do globals/globals
{txt}
{com}. version 16.1
{txt}
{com}. 
. // The number of imputations to perform.
. global m_imputations 50 // Very slightly narrower CI if m=100.
{txt}
{com}. 
. // Define the names of the process outcomes.
. global process_outcomes ""
{txt}
{com}. global process_outcomes $process_outcomes attendance hypertension diabetes
{txt}
{com}. global process_outcomes $process_outcomes malpresentation anemia fetalgrowth
{txt}
{com}. 
. // Define the names of the time outcomes.
. global time_outcomes ""
{txt}
{com}. global time_outcomes $time_outcomes info_management
{txt}
{com}. 
. // The variables to adjust for, with their "types". See the generated report for
. // an explanation of why these variables are adjusted for.
. global adj_vars i.strat_var c.cluster_size c.age i.lab_available i.primiparous
{txt}
{com}. global adj_var_names // A global with just the *names* of the adj_vars
{txt}
{com}. foreach x of global adj_vars {c -(}
{txt}  2{com}.   local x_name = substr("`x'", 3, .) // Remove the i. or c.
{txt}  3{com}.   global adj_var_names $adj_var_names `x_name'
{txt}  4{com}. {c )-}
{txt}
{com}. 
. // Define paths to the process outcome files.
. global fname_attendance      "data/raw/25June2020_eRegQual process outcomes_attendance.dta"
{txt}
{com}. global fname_hypertension    "data/raw/25June2020_eRegQual process outcomes_hypertension.dta"
{txt}
{com}. global fname_diabetes        "data/raw/25June2020_eRegQual process outcomes_diabetes.dta"
{txt}
{com}. global fname_malpresentation "data/raw/25June2020_eRegQual process outcomes_malpresentation.dta"
{txt}
{com}. global fname_anemia          "data/raw/02July2020_eRegQual process outcomes_anemia.dta"
{txt}
{com}. global fname_fetalgrowth     "data/raw/10August2020_eRegQual process outcomes_fetalgrowth.dta"
{txt}
{com}. 
. // Define paths to the time outcome file.
. global fname_time            "data/raw/05August2020_eRegTime.dta"
{txt}
{com}. 
. // Define data signatures for the process outcome files.
. global datasignature_attendance          "6367:39(51496):3578513271:2127801624"
{txt}
{com}. global datasignature_hypertension        "6367:60(68365):3970041110:3735367683"
{txt}
{com}. global datasignature_diabetes            "6367:38(91264):1895688975:3113856828"
{txt}
{com}. global datasignature_malpresentation     "6367:31(88392):1586201653:3483051938"
{txt}
{com}. global datasignature_anemia              "6367:51(74410):3453863737:2485498443"
{txt}
{com}. global datasignature_fetalgrowth         "6367:37(83879):2470058122:813121498"
{txt}
{com}. 
. // Define data signature for the time data.
. global datasignature_time                "241:24(68218):3592272240:210409283"
{txt}
{com}. 
. // Define recoding rules for the arm variables of the process outcomes; the 
. // coding of control and intervention vary by outcome. We will adopt the 
. // convention that control is coded as 1 and intervention as 2.
. global recode_attendance   recode arm (1 = 2) (2 = 1)
{txt}
{com}. global recode_hypertension recode arm (1 = 2) (2 = 1)
{txt}
{com}. foreach x in diabetes malpresentation anemia fetalgrowth {c -(}
{txt}  2{com}.   global recode_`x' // No recoding necessary
{txt}  3{com}. {c )-}
{txt}
{com}. 
{txt}end of do-file

{com}. do data/time_outcomes
{txt}
{com}. version 16.1
{txt}
{com}. 
. // Load the data and check its signature is as expected.
. frame create time
{txt}
{com}. frame time {c -(}
.   // Import the data and verify its signature.
.   use "${c -(}fname_time{c )-}", replace
.   datasignature
  {res}241:24(68218):3592272240:210409283
{com}.   assert r(datasignature) == "${c -(}datasignature_time{c )-}"
. 
.   // Encode/rename arm variable.
.   encode exposure, generate(arm)
.   label variable arm Arm
. 
.   // Rename cluster identifier variables.
.   rename clinicnumber clusterid
{res}{com}.   label variable clusterid Cluster
. 
.   // TODO: Need district as strat_var.
.   // TODO: Need age.
.   // TODO: Need primiparous
. 
.   // Lab availability.
.   label variable lab_available "Lab available"
.   label define lab_available_label 1 "Lab" 0 "No lab"
.   label values lab_available lab_available_label
. 
. 
.   // Compute the cluster size from the trial data. We use the trial data for
.   // simplicity and have verified that these agree with the "baseline" data on
.   // trial size. We divide by 100 because cluster sizes range from about 10 to
.   // about 220, and we want to get regression coefficients that are non-null
.   // within two decimal places! Note that cluster size computation must be
.   // done before the data set is reshaped to long format, or we will count
.   // one enrollment per visit rather than pregnancy.
.   by clusterid, sort: generate cluster_size = _N / 100
. 
.   // Keep only the variables of interest.
.   keep y arm clusterid $adj_var_names
{err}variable {bf}y{sf} not found
{txt}{search r(111), local:r(111);}
{com}. {c )-}
{txt}{search r(111), local:r(111);}

end of do-file

{search r(111), local:r(111);}

{com}. do data/time_outcomes
{txt}
{com}. version 16.1
{txt}
{com}. 
. // Load the data and check its signature is as expected.
. frame create time
{err}frame {bf}time{sf} already defined
{txt}{search r(110), local:r(110);}

end of do-file

{search r(110), local:r(110);}

{com}. clear all
{res}
{com}. do globals/globals
{txt}
{com}. version 16.1
{txt}
{com}. 
. // The number of imputations to perform.
. global m_imputations 50 // Very slightly narrower CI if m=100.
{txt}
{com}. 
. // Define the names of the process outcomes.
. global process_outcomes ""
{txt}
{com}. global process_outcomes $process_outcomes attendance hypertension diabetes
{txt}
{com}. global process_outcomes $process_outcomes malpresentation anemia fetalgrowth
{txt}
{com}. 
. // Define the names of the time outcomes.
. global time_outcomes ""
{txt}
{com}. global time_outcomes $time_outcomes info_management
{txt}
{com}. 
. // The variables to adjust for, with their "types". See the generated report for
. // an explanation of why these variables are adjusted for.
. global adj_vars i.strat_var c.cluster_size c.age i.lab_available i.primiparous
{txt}
{com}. global adj_var_names // A global with just the *names* of the adj_vars
{txt}
{com}. foreach x of global adj_vars {c -(}
{txt}  2{com}.   local x_name = substr("`x'", 3, .) // Remove the i. or c.
{txt}  3{com}.   global adj_var_names $adj_var_names `x_name'
{txt}  4{com}. {c )-}
{txt}
{com}. 
. // Define paths to the process outcome files.
. global fname_attendance      "data/raw/25June2020_eRegQual process outcomes_attendance.dta"
{txt}
{com}. global fname_hypertension    "data/raw/25June2020_eRegQual process outcomes_hypertension.dta"
{txt}
{com}. global fname_diabetes        "data/raw/25June2020_eRegQual process outcomes_diabetes.dta"
{txt}
{com}. global fname_malpresentation "data/raw/25June2020_eRegQual process outcomes_malpresentation.dta"
{txt}
{com}. global fname_anemia          "data/raw/02July2020_eRegQual process outcomes_anemia.dta"
{txt}
{com}. global fname_fetalgrowth     "data/raw/10August2020_eRegQual process outcomes_fetalgrowth.dta"
{txt}
{com}. 
. // Define paths to the time outcome file.
. global fname_time            "data/raw/05August2020_eRegTime.dta"
{txt}
{com}. 
. // Define data signatures for the process outcome files.
. global datasignature_attendance          "6367:39(51496):3578513271:2127801624"
{txt}
{com}. global datasignature_hypertension        "6367:60(68365):3970041110:3735367683"
{txt}
{com}. global datasignature_diabetes            "6367:38(91264):1895688975:3113856828"
{txt}
{com}. global datasignature_malpresentation     "6367:31(88392):1586201653:3483051938"
{txt}
{com}. global datasignature_anemia              "6367:51(74410):3453863737:2485498443"
{txt}
{com}. global datasignature_fetalgrowth         "6367:37(83879):2470058122:813121498"
{txt}
{com}. 
. // Define data signature for the time data.
. global datasignature_time                "241:24(68218):3592272240:210409283"
{txt}
{com}. 
. // Define recoding rules for the arm variables of the process outcomes; the 
. // coding of control and intervention vary by outcome. We will adopt the 
. // convention that control is coded as 1 and intervention as 2.
. global recode_attendance   recode arm (1 = 2) (2 = 1)
{txt}
{com}. global recode_hypertension recode arm (1 = 2) (2 = 1)
{txt}
{com}. foreach x in diabetes malpresentation anemia fetalgrowth {c -(}
{txt}  2{com}.   global recode_`x' // No recoding necessary
{txt}  3{com}. {c )-}
{txt}
{com}. 
{txt}end of do-file

{com}. do data/time_outcomes
{txt}
{com}. version 16.1
{txt}
{com}. 
. // Load the data and check its signature is as expected.
. frame create time
{txt}
{com}. frame time {c -(}
.   // Import the data and verify its signature.
.   use "${c -(}fname_time{c )-}", replace
.   datasignature
  {res}241:24(68218):3592272240:210409283
{com}.   assert r(datasignature) == "${c -(}datasignature_time{c )-}"
. 
.   // Encode/rename arm variable.
.   encode exposure, generate(arm)
.   label variable arm Arm
. 
.   // 
.   
. 
.   // Rename cluster identifier variables.
.   rename clinicnumber clusterid
{res}{com}.   label variable clusterid Cluster
. 
.   // TODO: Need district as strat_var.
.   // TODO: Need age.
.   // TODO: Need primiparous
. 
.   // Lab availability.
.   label variable lab_available "Lab available"
.   label define lab_available_label 1 "Lab" 0 "No lab"
.   label values lab_available lab_available_label
. 
. 
.   // Compute the cluster size from the trial data. We use the trial data for
.   // simplicity and have verified that these agree with the "baseline" data on
.   // trial size. We divide by 100 because cluster sizes range from about 10 to
.   // about 220, and we want to get regression coefficients that are non-null
.   // within two decimal places! Note that cluster size computation must be
.   // done before the data set is reshaped to long format, or we will count
.   // one enrollment per visit rather than pregnancy.
.   by clusterid, sort: generate cluster_size = _N / 100
. 
.   // Keep only the variables of interest.
.   // TODO: keep arm clusterid $adj_var_names // TODO: Add y vars
. 
.   // TODO: Take logs of the time variables!
. {c )-}
{txt}
{com}. 
{txt}end of do-file

{com}. frame change time

. codebook observercode 

{txt}{hline}
{res}observercode{right:Observer code}
{txt}{hline}

{col 19}type:  numeric ({res}byte{txt})

{col 18}range:  [{res}1{txt},{res}4{txt}]{col 55}units:  {res}1
{col 10}{txt}unique values:  {res}4{col 51}{txt}missing .:  {res}0{txt}/{res}241

{txt}{col 13}tabulation:  Freq.  Value
{col 21}{res}        46{col 33}1
{col 21}        84{col 33}2
{col 21}        40{col 33}3
{col 21}        71{col 33}4

{com}. 